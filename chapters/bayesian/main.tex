\section*{Байесовские методы классификации}
Решаем задачу классификации. Пусть $A = A_1 \times \ldots \times A_m$ --- пространство объектов, $B$ --- конечное множество классов. Предположим, что объекты $(x, y) \in A \times B$ независимо выбираются из какого-то неизвестного распределения с обобщённой плотностью распределения $p(x, y)$. Пусть $(X, Y)$ --- случайная величина на $A \times B$ с таким распределением. Хотим по $x$ находить его наиболее вероятный класс, то есть класс $y$, максимизирующий $P(Y=y|X=x)$. По формуле Байеса $P(y|x)=\frac{P(y)p(x|y)}{p(x)}$, поэтому максимизация $P(y|x)$ равносильна максимизации $P(y)p(x|y)$. Таким образом, задача сводится к восстанавлению дискретного априорного распределения $P(y)$ и восстановлению условного распределения $p(x|y)$.

Обычно предполагается, что $Y$ имеет произвольное категориальное распределение на $B$, то есть что о распределении $Y$ нет никакой информации, кроме множества принимаемых значений. В этом случае можно аналитически найти оценку на параметры распределения $P(Y=b_i)$ методом максимального правдоподобия.

\textbf{Задача 1.} Пусть $N$ --- количество элементов в выборке. Для любого $b \in B$ обозначим через $N_b$ --- количество элементов, для которых $y=b$ и через $\overline{p_b}$ --- частоту, с которой $y$ принимает значение $b$, то есть $\overline{p_b} = \frac{N_b}{N}$. Докажите, что $\overline{p_b}$ --- оценка максимального правдоподобия вероятностей $P(Y=b)$. \\
\textit{Указание: перейдите к максимизации логарифма правдоподобия и воспользуйтесь неравенством Гиббса.}


\subsection*{Наивный Байесовский классификатор}

Наивный Байесовский классификатор делает предположение, что признаки независимы в совокупности при условии классов, то есть для любого $k$, любых $i_1 < \ldots < i_k$ и любых $x_1, \ldots, x_k, y$ выполнено $p(X_{i_1}=x_1, \ldots, X_{i_k} = x_k|Y=y)=p(X_{i_1}=x_1|Y=y)\cdot\ldots\cdot p(X_{i_k}=x_k|Y=y)$. Отметим, что треубется именно независимость $X_i$ при условии $Y$, а не просто независимость $X_i$.

\textbf{Задача 2.} \\
a) Приведите пример совместного распределения бернуллиевских случайных величин $X_1, X_2, Y$ при котором $X_1$ и $X_2$ независимы, но не независимы при условии $Y$. \\
b) Приведите пример совместного распределения бернуллиевских случайных величин $X_1, X_2, Y$ при котором $X_1$ и $X_2$ независимы при условии $Y$, но не независимы.

Для каждого класса $b \in B$ и для каждого признака решается одномерная задача восстановления плотности $P(X_i|Y=b)$. Таким образом, предположение об условной независимости позволяет свести сложную задачу восстановления плотности многомерного распределения к более простой задаче восстановления плотности одномерного распределения.

Рассмотрим случай, когда предполагается, что условные расперделения признаков при условии класса берутся из какого-то экспоненциального семейства распределений, то есть $p(x|y) = \exp \left(\frac{\theta_y x-c(\theta_y)}{\phi_y} + h(x, \phi_y) \right)$, где $\theta_y, \phi_y$ --- параметры распределения. Параметры распределения оцениваем метода максимального правдоподобия, то есть $(\overline{\theta_y}, \overline{\phi_y}) = \text{argmax}_{\theta, \phi}\left(\sum_{i=1}^{N} \frac{\theta_yx^i-c(\theta_y)}{\phi_y} + h(x^i, \phi_y) \right)$.
Для многих распределений эта задача оптимизации решается аналитически.

В итоге после восстановления параметров получаем формулу для оценки вероятности класса
$$P(Y=y|X=x) = \frac{P(Y=y)p(X=x|Y=y)}{p(X=x)} = $$ $$ = \exp \left( \sum_{j=1}^{m} \frac{\overline{\theta_{yj}}}{\overline{\phi_{yj}}}x_j + \sum_{j=1}^{m}h(x_j, \overline{\phi_{yj}}) - \sum_{j=1}^{m}\frac{c_j(\overline{\theta_{yj}})}{\overline{\varphi_{yj}}} + \ln \overline{P(Y=y)} - \ln p(X=x) \right).$$

В случае, если $\overline{\varphi_{yj}}$ не зависит от $y$, то $\sum_{j=1}^{m}h(x_j, \overline{\phi_{yj}})$ и $\ln p(X=x)$ не зависят от $y$, поэтому максимизация вероятности класса эквивалентна максимизации $\sum_{j=1}^{m}w_{yj}x_j + w_{y0}$, где $w_{yj}=\frac{\overline{\theta_{yj}}}{\overline{\phi_{yj}}}$, $w_{y0}=\ln \overline{P(Y=y)} - \sum_{j=1}^{m}\frac{c_j(\overline{\theta_{yj}})}{\overline{\varphi_{yj}}}.$ Таким образом, в этом случае наивный байесовский классификатор строит линейную разделяющую поверхность.

\textbf{Задача 3.} Проверьте, что если все признаки бинарные, то наивный байесовский классификатор с $2$ классами эквивалентен логистической регрессии с фиксированными весами и найдите эти веса.

\section{Оценка производительности байесовских классификаторов}

\subsection{Введение}
Оценка производительности классификаторов — это важный этап в разработке моделей машинного обучения. Она позволяет понять, насколько хорошо модель справляется с задачей классификации, и выявить возможные недостатки. Для байесовских классификаторов, таких как наивный байесовский классификатор, существует несколько метрик, которые помогают оценить их эффективность.

\subsection{Основные метрики оценки производительности}

\textbf{Меткость (Accuracy)}
Определяется как доля правильно классифицированных объектов от общего числа объектов:
\[
\text{Accuracy} = \frac{TP + TN}{TP + TN + FP + FN}
\]
где:
\begin{itemize}
    \item \(TP\) — количество истинно положительных,
    \item \(TN\) — количество истинно отрицательных,
    \item \(FP\) — количество ложноположительных,
    \item \(FN\) — количество ложноотрицательных.
\end{itemize}

\textbf{Полнота (Recall)}
Показывает, какую долю положительных случаев модель смогла правильно классифицировать:
\[
\text{Recall} = \frac{TP}{TP + FN}
\]

\textbf{Точность (Precision)}
Отражает, сколько из всех объектов, классифицированных как положительные, действительно являются положительными:
\[
\text{Precision} = \frac{TP}{TP + FP}
\]

\textbf{F-мера (F1 Score)}
Гармоническое среднее между точностью и полнотой:
\[
F1 = 2 \cdot \frac{\text{Precision} \cdot \text{Recall}}{\text{Precision} + \text{Recall}}
\]

\subsection{ROC-кривая и AUC (Area Under Curve)}
ROC-кривая отображает соотношение между полнотой и ложноположительными срабатываниями при различных порогах классификации. AUC представляет собой площадь под ROC-кривой и показывает общую способность модели различать классы.

\subsection{Задачи с решениями}

\textbf{Задача 1}

\textbf{Условие}: У вас есть следующие результаты классификации:

\begin{itemize}
    \item Истинно положительные (TP): 50
    \item Истинно отрицательные (TN): 30
    \item Ложноположительные (FP): 15
    \item Ложноотрицательные (FN): 5
\end{itemize}
Рассчитайте меткость

\textbf{Решение}:
\[
\text{Accuracy} = \frac{TP + TN}{TP + TN + FP + FN} = \frac{50 + 30}{50 + 30 + 15 + 5} = \frac{80}{100} = 0.8
\]
\textbf{Ответ}: Точность классификатора составляет 0.8 (или 80\%).
\newline
\newline
\textbf{Задача 2}

\textbf{Условие}: Допустим, мы хотим оценить работу спам-фильтра почты. У нас есть 100 не-спам писем, 90 из которых наш классификатор определил верно (True Negative = 90, False Positive = 10), и 10 спам-писем, 5 из которых классификатор также определил верно (True Positive = 5, False Negative = 5). Необходимо рассчитать полноту и точность.

\textbf{Решение}:
Рассчитаем полноту:
\[
\text{Recall} = \frac{TP}{TP + FN} = \frac{5}{5 + 5} = \frac{5}{10} = 0.5
\]
Рассчитаем точность:
\[
\text{Precision} = \frac{TP}{TP + FP} = \frac{5}{5 + 10} = \frac{5}{15} \approx 0.33
\]
\textbf{Ответ}: Полнота составляет 0.5 (или 50\%), точность же составляет примерно 0.33 (или 33\%).
\newline
\newline
\textbf{Задача 3}

\textbf{Условие}: Используя результаты из предыдущей задачи, найдите F-меру.

\textbf{Решение}:
Используем значения точности и полноты, найденные ранее:
\[
F1 = 2 \cdot \frac{\text{Precision} \cdot \text{Recall}}{\text{Precision} + \text{Recall}} = 2 \cdot \frac{0.5 \cdot 0.33}{0.5 + 0.33} = 2 \cdot \frac{0.165}{0.83} \approx 0.398
\]
\textbf{Ответ}: F-мера составляет примерно 0.398 (или 39.8\%).
